{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _a;\n\nvar React = require(\"react\");\n\nvar core_1 = require(\"@aws-amplify/core\");\n\nvar Amplify_UI_Theme_1 = require(\"../Amplify-UI/Amplify-UI-Theme\");\n\nvar Amplify_UI_Components_React_1 = require(\"../Amplify-UI/Amplify-UI-Components-React\");\n\nvar types_1 = require(\"./common/types\");\n\nvar PhoneField_1 = require(\"./PhoneField\");\n\nvar data_test_attributes_1 = require(\"../Amplify-UI/data-test-attributes\");\n\nvar labelMap = (_a = {}, _a[types_1.UsernameAttributes.EMAIL] = 'Email', _a[types_1.UsernameAttributes.PHONE_NUMBER] = 'Phone Number', _a[types_1.UsernameAttributes.USERNAME] = 'Username', _a);\n\nvar AuthPiece =\n/** @class */\nfunction (_super) {\n  __extends(AuthPiece, _super);\n\n  function AuthPiece(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.inputs = {};\n    _this._isHidden = true;\n    _this._validAuthStates = [];\n    _this.phone_number = '';\n    _this.changeState = _this.changeState.bind(_this);\n    _this.error = _this.error.bind(_this);\n    _this.handleInputChange = _this.handleInputChange.bind(_this);\n    _this.renderUsernameField = _this.renderUsernameField.bind(_this);\n    _this.getUsernameFromInput = _this.getUsernameFromInput.bind(_this);\n    _this.onPhoneNumberChanged = _this.onPhoneNumberChanged.bind(_this);\n    return _this;\n  }\n\n  AuthPiece.prototype.componentDidMount = function () {\n    if (window && window.location && window.location.search) {\n      if (!this.props.authData || !this.props.authData.username) {\n        var searchParams = new URLSearchParams(window.location.search);\n        var username = searchParams ? searchParams.get('username') : undefined;\n        this.setState({\n          username: username\n        });\n      }\n    }\n  };\n\n  AuthPiece.prototype.getUsernameFromInput = function () {\n    var _a = this.props.usernameAttributes,\n        usernameAttributes = _a === void 0 ? 'username' : _a;\n\n    switch (usernameAttributes) {\n      case types_1.UsernameAttributes.EMAIL:\n        return this.inputs.email;\n\n      case types_1.UsernameAttributes.PHONE_NUMBER:\n        return this.phone_number;\n\n      default:\n        return this.inputs.username || this.state.username;\n    }\n  };\n\n  AuthPiece.prototype.onPhoneNumberChanged = function (phone_number) {\n    this.phone_number = phone_number;\n  };\n\n  AuthPiece.prototype.renderUsernameField = function (theme) {\n    var _a = this.props.usernameAttributes,\n        usernameAttributes = _a === void 0 ? [] : _a;\n\n    if (usernameAttributes === types_1.UsernameAttributes.EMAIL) {\n      return React.createElement(Amplify_UI_Components_React_1.FormField, {\n        theme: theme\n      }, React.createElement(Amplify_UI_Components_React_1.InputLabel, {\n        theme: theme\n      }, core_1.I18n.get('Email'), \" *\"), React.createElement(Amplify_UI_Components_React_1.Input, {\n        autoFocus: true,\n        placeholder: core_1.I18n.get('Enter your email'),\n        theme: theme,\n        key: \"email\",\n        name: \"email\",\n        onChange: this.handleInputChange,\n        \"data-test\": data_test_attributes_1.auth.genericAttrs.emailInput\n      }));\n    } else if (usernameAttributes === types_1.UsernameAttributes.PHONE_NUMBER) {\n      return React.createElement(PhoneField_1.PhoneField, {\n        theme: theme,\n        onChangeText: this.onPhoneNumberChanged\n      });\n    } else {\n      return React.createElement(Amplify_UI_Components_React_1.FormField, {\n        theme: theme\n      }, React.createElement(Amplify_UI_Components_React_1.InputLabel, {\n        theme: theme\n      }, core_1.I18n.get(this.getUsernameLabel()), \" *\"), React.createElement(Amplify_UI_Components_React_1.Input, {\n        defaultValue: this.state.username,\n        autoFocus: true,\n        placeholder: core_1.I18n.get('Enter your username'),\n        theme: theme,\n        key: \"username\",\n        name: \"username\",\n        onChange: this.handleInputChange,\n        \"data-test\": data_test_attributes_1.auth.genericAttrs.usernameInput\n      }));\n    }\n  };\n\n  AuthPiece.prototype.getUsernameLabel = function () {\n    var _a = this.props.usernameAttributes,\n        usernameAttributes = _a === void 0 ? types_1.UsernameAttributes.USERNAME : _a;\n    return labelMap[usernameAttributes] || usernameAttributes;\n  }; // extract username from authData\n\n\n  AuthPiece.prototype.usernameFromAuthData = function () {\n    var authData = this.props.authData;\n\n    if (!authData) {\n      return '';\n    }\n\n    var username = '';\n\n    if (typeof authData === 'object') {\n      // user object\n      username = authData.user ? authData.user.username : authData.username;\n    } else {\n      username = authData; // username string\n    }\n\n    return username;\n  };\n\n  AuthPiece.prototype.errorMessage = function (err) {\n    if (typeof err === 'string') {\n      return err;\n    }\n\n    return err.message ? err.message : JSON.stringify(err);\n  };\n\n  AuthPiece.prototype.triggerAuthEvent = function (event) {\n    var state = this.props.authState;\n\n    if (this.props.onAuthEvent) {\n      this.props.onAuthEvent(state, event);\n    }\n  };\n\n  AuthPiece.prototype.changeState = function (state, data) {\n    if (this.props.onStateChange) {\n      this.props.onStateChange(state, data);\n    }\n\n    this.triggerAuthEvent({\n      type: 'stateChange',\n      data: state\n    });\n  };\n\n  AuthPiece.prototype.error = function (err) {\n    this.triggerAuthEvent({\n      type: 'error',\n      data: this.errorMessage(err)\n    });\n  };\n\n  AuthPiece.prototype.handleInputChange = function (evt) {\n    this.inputs = this.inputs || {};\n    var _a = evt.target,\n        name = _a.name,\n        value = _a.value,\n        type = _a.type,\n        checked = _a.checked;\n    var check_type = ['radio', 'checkbox'].includes(type);\n    this.inputs[name] = check_type ? checked : value;\n    this.inputs['checkedValue'] = check_type ? value : null;\n  };\n\n  AuthPiece.prototype.render = function () {\n    if (!this._validAuthStates.includes(this.props.authState)) {\n      this._isHidden = true;\n      this.inputs = {};\n      return null;\n    }\n\n    if (this._isHidden) {\n      this.inputs = {};\n      var track = this.props.track;\n      if (track) track();\n    }\n\n    this._isHidden = false;\n    return this.showComponent(this.props.theme || Amplify_UI_Theme_1.default);\n  };\n\n  AuthPiece.prototype.showComponent = function (theme) {\n    throw 'You must implement showComponent(theme) and don\\'t forget to set this._validAuthStates.';\n  };\n\n  return AuthPiece;\n}(React.Component);\n\nexports.default = AuthPiece;","map":null,"metadata":{},"sourceType":"script"}